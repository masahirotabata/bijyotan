<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¾å¥³å˜èªï¼šç„¡åŒPartï¼ˆè¦‹ã‚‹ç³»ï¼‰</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #fff0f6;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #e91e63;
      font-size: 30px;
      margin-bottom: 10px;
    }
    .word-card {
      background: #eef7ff;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin: 20px auto;
      padding: 12px;
      max-width: 500px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    video {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
    }
    .back-button {
      background-color: #e91e63;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      margin-top: 20px;
      cursor: pointer;
    }
    .back-button:hover {
      background-color: #d81b60;
    }
  </style>
</head>
<body>
  <h1>ğŸ¬ ç„¡åŒPartï¼ˆä¼¼ãŸæ„å‘³ã‚’ä¸€æ°—ã«ç†è§£ï¼‰</h1>
  <div id="word-container"></div>
  <button class="back-button" onclick="goBack()">â† æˆ»ã‚‹</button>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    let user = null;

    window.onload = async function () {
      const params = new URLSearchParams(window.location.search);
      const userId = params.get("userId");
      const part = params.get("part");

      try {
        const res = await fetch(`http://localhost:8080/user/${userId}`);
        if (!res.ok) throw new Error("HTTPã‚¨ãƒ©ãƒ¼ï¼š" + res.status);

        user = await res.json();
        console.log("å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±:", user);

        if (!user.premium) {
          showPremiumPopup();
          return;
        }

      } catch (error) {
        console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
        alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        return;
      }

      // âœ… å­¦ç¿’çŠ¶æ…‹ä»˜ãã§å˜èªã‚’å–å¾—
      try {
        const response = await fetch(`/api/words/withStatus?userId=${userId}&part=${encodeURIComponent(part)}`);
        if (!response.ok) throw new Error("å˜èªã®å–å¾—ã«å¤±æ•—");

        const words = await response.json();
        const container = document.getElementById("word-container");
        container.innerHTML = "";

        words.forEach(word => {
          const card = document.createElement("div");
          card.className = "word-card";

          const title = document.createElement("h3");
          title.innerHTML = `${word.word}ï¼ˆ${word.meaning}ï¼‰`;

          const video = document.createElement("video");
          video.src = word.pictUrlAnimated || "/videos/sample_motion.mp4";
          video.controls = true;
          video.loop = true;

          card.appendChild(title);
          card.appendChild(video);
          container.appendChild(card);
        });

      } catch (e) {
        console.error("å˜èªå–å¾—ã‚¨ãƒ©ãƒ¼ï¼š", e);
        alert("å˜èªãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    };

    // ğŸ€ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
    function showPremiumPopup() {
  const userId = new URLSearchParams(window.location.search).get('userId');

  Swal.fire({
    title: 'ğŸ€ ç¾å¥³å˜ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ ğŸ€',
    html: `
      <div style="text-align:left; font-size: 0.95rem;">
        <p>å…¨ãƒ¢ãƒ¼ãƒ‰è§£æ”¾ï¼†åºƒå‘Šãªã—ã®è´…æ²¢ä½“é¨“</p>
        <ul style="line-height:1.6;">
          <li>âœ” ç¾å¥³ã®å…¨ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å‹•ç”»ãŒç„¡åˆ¶é™å†ç”Ÿ</li>
          <li>âœ” ãƒªã‚¹ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰è§£æ”¾</li>
          <li>âœ” è¤’ã‚ãƒœã‚¤ã‚¹ä»˜ãæ¼”å‡ºå¼·åŒ–</li>
          <li>âœ” ãƒ†ã‚¹ãƒˆå›æ•°ç„¡åˆ¶é™ï¼†æˆç¸¾å±¥æ­´ã‚‚ä¿å­˜</li>
        </ul>
        <p style="font-weight:bold; font-size:1.1rem;">ğŸ’° æœˆé¡1,200å††ï¼ˆç¨è¾¼ï¼‰</p>
        <p style="color:red;">âœ¨ ä»Šã ã‘åˆæœˆ500å††ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸­ âœ¨</p>
        <small>SNSã§ã‚·ã‚§ã‚¢ã™ã‚‹ã¨1é€±é–“ç„¡æ–™ä½“é¨“ğŸ</small>
      </div>
    `,
    showCancelButton: true,
    confirmButtonText: "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã«ç™»éŒ²ã™ã‚‹",
    cancelButtonText: "ã‚ã¨ã§è¦‹ã‚‹",
    customClass: {
      popup: 'premium-popup',
      confirmButton: 'btn-premium'
    }
  }).then(result => {
    if (result.isConfirmed) {
      window.location.href = "/premium.html";
    } else if (result.dismiss === Swal.DismissReason.cancel) {
      window.location.href = `user.html?userId=${userId}`;
    }
  });
}

    // â† æˆ»ã‚‹ãƒœã‚¿ãƒ³å‡¦ç†
    function goBack() {
      const userId = new URLSearchParams(window.location.search).get('userId') || 1;
      window.location.href = `user.html?userId=${userId}`;
    }
  </script>
</body>
</html>
