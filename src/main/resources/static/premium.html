<script>
function onPaymentSuccess() {
  const userIdStr = localStorage.getItem("userId");

  // null, undefined, "", "null", NaN ã®ã™ã¹ã¦ã«å¯¾å¿œ
  const userId = parseInt(userIdStr, 10);
  if (!userId || isNaN(userId)) {
    alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ã¦ãã ã•ã„ã€‚");
    return;
  }

  fetch(`https://bijyotan.onrender.com/user/upgrade?userId=${userId}`, {
    method: "PUT"
  })
  .then(res => {
    if (!res.ok) throw new Error("ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¤±æ•—");
    return res.text();
  })
  .then(msg => {
    alert(msg);
    window.location.href = `user.html?userId=${userId}`;
  })
  .catch(err => {
    alert("ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ");
    console.error(err);
  });
}

// ğŸ‘‡ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å‘¼ã³å‡ºã™
window.addEventListener('DOMContentLoaded', onPaymentSuccess);
</script>
