<script>
function onPaymentSuccess() {
  const userIdStr = localStorage.getItem("userId");

  // null, undefined, "", "null", NaN のすべてに対応
  const userId = parseInt(userIdStr, 10);
  if (!userId || isNaN(userId)) {
    alert("ユーザーIDが取得できませんでした。ログインし直してください。");
    return;
  }

  fetch(`/user/${userId}/upgrade`, {
    method: "PUT"
    credentials: "include",         // セッション等を使う場合は付ける
  })
  .then(res => {
    if (!res.ok) throw new Error("アップグレード失敗");
    return res.text();
  })
  .then(msg => {
    alert(msg);
    window.location.href = `user.html?userId=${userId}`;
  })
  .catch(err => {
    alert("アップグレードに失敗しました");
    console.error(err);
  });
}

// 👇 ページ読み込み時に呼び出す
window.addEventListener('DOMContentLoaded', onPaymentSuccess);
</script>
